apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "kubeapps.apprepository-jobs-bootstrap.fullname" . }}
  annotations:
    helm.sh/hook: post-install
    helm.sh/hook-delete-policy: hook-succeeded
    helm.sh/hook-weight: "-10"
  labels:
    app: {{ template "kubeapps.apprepository-jobs-bootstrap.fullname" . }}
    chart: {{ template "kubeapps.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
data:
  apprepositories.yaml: |-
    apiVersion: apiextensions.k8s.io/v1beta1
    kind: CustomResourceDefinition
    metadata:
      name: apprepositories.kubeapps.com
      labels:
        app: {{ template "kubeapps.apprepository.fullname" . }}
        chart: {{ template "kubeapps.chart" . }}
        release: {{ .Release.Name }}
        heritage: {{ .Release.Service }}
    spec:
      group: kubeapps.com
      names:
        kind: AppRepository
        plural: apprepositories
        shortNames:
        - apprepos
      version: v1alpha1
    ---
    {{- range .Values.apprepository.initialRepos }}
    apiVersion: kubeapps.com/v1alpha1
    kind: AppRepository
    metadata:
      name: {{ .name }}
      labels:
        app: {{ template "kubeapps.apprepository.fullname" $ }}
        chart: {{ template "kubeapps.chart" $ }}
        release: {{ $.Release.Name }}
        heritage: {{ $.Release.Service }}
    spec:
      type: helm
      url: {{ .url }}
    ---
    {{ end -}}
